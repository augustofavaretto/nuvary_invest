<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doc 17 - Integracao ANBIMA API (Renda Fixa) | Nuvary Invest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00B8D9;
            --primary-dark: #007EA7;
            --secondary: #10b981;
            --dark: #0B1F33;
            --gray: #6B7280;
            --light: #F3F4F6;
            --white: #ffffff;
            --code-bg: #1e293b;
            --border: #E5E7EB;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #334155;
            background: var(--light);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, #1e3a5f 0%, #0066CC 50%, #00B8D9 100%);
            color: white;
            padding: 50px 0;
            text-align: center;
        }

        .version-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        nav {
            background: var(--white);
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        nav a {
            color: var(--gray);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--primary);
        }

        main {
            padding: 40px 0;
        }

        section {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        h2 {
            color: var(--dark);
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h3 {
            color: var(--dark);
            font-size: 1.2rem;
            margin: 25px 0 15px;
        }

        p {
            margin-bottom: 15px;
            color: #475569;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 25px;
            border-left: 4px solid var(--primary);
        }

        .feature-card h4 {
            color: var(--dark);
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-card p {
            color: var(--gray);
            font-size: 0.95rem;
            margin-bottom: 0;
        }

        .component-list {
            list-style: none;
            padding: 0;
        }

        .component-item {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--secondary);
        }

        .component-item h4 {
            color: var(--dark);
            font-size: 1rem;
            margin-bottom: 8px;
            font-family: 'Fira Code', monospace;
        }

        .component-item p {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 0;
        }

        pre {
            background: var(--code-bg);
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            margin: 15px 0;
        }

        code {
            font-family: 'Fira Code', 'Consolas', monospace;
            background: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9rem;
            color: var(--dark);
        }

        .api-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .api-table th,
        .api-table td {
            border: 1px solid var(--border);
            padding: 12px 15px;
            text-align: left;
        }

        .api-table th {
            background: var(--dark);
            color: white;
            font-weight: 600;
        }

        .api-table tr:nth-child(even) {
            background: #f8fafc;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .tech-badge {
            background: linear-gradient(135deg, var(--dark) 0%, #1e3a5f 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .architecture-diagram {
            background: linear-gradient(135deg, #0B1F33 0%, #1e3a5f 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .architecture-diagram h4 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .arch-flow {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .arch-box {
            background: rgba(255,255,255,0.1);
            padding: 15px 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .arch-arrow {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .highlight-box {
            background: linear-gradient(135deg, #00B8D9 0%, #007EA7 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .highlight-box h4 {
            margin-bottom: 10px;
        }

        .new-badge {
            display: inline-block;
            background: var(--secondary);
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
            font-weight: 600;
        }

        .status-ok {
            color: #10b981;
            font-weight: 600;
        }

        .status-pending {
            color: #f59e0b;
            font-weight: 600;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            font-weight: 700;
            font-size: 0.9rem;
            margin-right: 10px;
        }

        .step-item {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
        }

        .step-item h4 {
            color: var(--dark);
            font-size: 1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .step-item p {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 0;
            margin-left: 40px;
        }

        footer {
            text-align: center;
            padding: 30px 0;
            color: var(--gray);
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <span class="version-badge">Versao 3.1.0</span>
            <h1>Integracao ANBIMA API (Renda Fixa)</h1>
            <p>Integracao com a API ANBIMA para titulos publicos, CRI/CRA e letras financeiras</p>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="index.html" style="color: #10b981; font-weight: 600;">Indice</a></li>
            <li><a href="#visao-geral">Visao Geral</a></li>
            <li><a href="#configuracao">Configuracao</a></li>
            <li><a href="#autenticacao">Autenticacao</a></li>
            <li><a href="#arquitetura">Arquitetura</a></li>
            <li><a href="#endpoints">Endpoints</a></li>
            <li><a href="#status">Status</a></li>
            <li><a href="#campos-resposta">Campos</a></li>
        </ul>
    </nav>

    <main class="container">
        <a href="index.html" class="back-link">Voltar para o indice</a>

        <!-- 1. VISAO GERAL -->
        <section id="visao-geral">
            <h2>Visao Geral</h2>
            <p>
                A ANBIMA (Associacao Nacional das Instituicoes do Mercado Financeiro) fornece precificacao
                oficial para titulos de renda fixa no mercado brasileiro. A API ANBIMA e a fonte de dados
                mais confiavel para precos de titulos publicos, CRI/CRA, letras financeiras e curvas de juros
                no Brasil.
            </p>
            <p>
                A integracao utiliza autenticacao OAuth2 com fluxo <code>client_credentials</code>, garantindo
                acesso seguro e automatizado aos dados de mercado. O token e gerenciado automaticamente pelo
                controller, com renovacao 5 minutos antes da expiracao.
            </p>

            <div class="tech-stack">
                <span class="tech-badge">OAuth2</span>
                <span class="tech-badge">REST API</span>
                <span class="tech-badge">Node.js</span>
                <span class="tech-badge">Express</span>
                <span class="tech-badge">Cache em Memoria</span>
            </div>

            <h3>Dados Disponiveis</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Titulos Publicos (TPF)</h4>
                    <p>Precos e taxas do mercado secundario de titulos publicos federais: LTN, LFT, NTN-B, NTN-C, NTN-F.</p>
                </div>
                <div class="feature-card">
                    <h4>Valor Nominal Atualizado (VNA)</h4>
                    <p>VNA dos titulos indexados: LFT (Selic), NTN-B (IPCA) e NTN-C (IGP-M). Atualizado diariamente.</p>
                </div>
                <div class="feature-card">
                    <h4>Curvas de Juros</h4>
                    <p>Estrutura a termo das taxas de juros utilizadas como referencia para precificacao de ativos.</p>
                </div>
                <div class="feature-card">
                    <h4>Estimativa Selic</h4>
                    <p>Estimativa da taxa Selic diaria e acumulada, utilizada como benchmark para renda fixa pos-fixada.</p>
                </div>
                <div class="feature-card">
                    <h4>Projecoes IPCA e IGP-M</h4>
                    <p>Projecoes de indices de inflacao utilizadas para precificacao de titulos indexados.</p>
                </div>
                <div class="feature-card">
                    <h4>CRI/CRA e Letras Financeiras</h4>
                    <p>Precos de mercado secundario de Certificados de Recebiveis (Imobiliarios e do Agronegocio) e Letras Financeiras.</p>
                </div>
            </div>
        </section>

        <!-- 2. CONFIGURACAO -->
        <section id="configuracao">
            <h2>Configuracao</h2>
            <p>
                As credenciais da ANBIMA sao configuradas atraves de variaveis de ambiente no arquivo
                <code>.env</code> do backend. O acesso a API requer cadastro previo no portal ANBIMA Feed.
            </p>

            <h3>Variaveis de Ambiente (.env)</h3>
            <pre>
# === ANBIMA API (Renda Fixa, Titulos Publicos) ===
ANBIMA_CLIENT_ID=hWaI3uCfX9wW
ANBIMA_CLIENT_SECRET=KUs4Bpe4ZCHD
ANBIMA_BASE_URL=https://api.anbima.com.br</pre>

            <h3>Bloco de Configuracao (config/index.js)</h3>
            <pre>
// backend/src/config/index.js
export const config = {
  // ... outras configuracoes ...

  anbima: {
    baseUrl: process.env.ANBIMA_BASE_URL || 'https://api.anbima.com.br',
    clientId: process.env.ANBIMA_CLIENT_ID,
    clientSecret: process.env.ANBIMA_CLIENT_SECRET,
  },

  cache: {
    ttl: parseInt(process.env.CACHE_TTL) || 300, // 5 minutos
  },
};</pre>

            <div class="highlight-box">
                <h4>Sobre as Credenciais</h4>
                <p>O client_id e client_secret sao fornecidos pela ANBIMA apos aprovacao do cadastro no portal ANBIMA Feed. As credenciais de sandbox permitem testes; o acesso a producao requer aprovacao adicional via anbimafeed@anbima.com.br.</p>
            </div>
        </section>

        <!-- 3. AUTENTICACAO OAUTH2 -->
        <section id="autenticacao">
            <h2>Autenticacao OAuth2</h2>
            <p>
                A API ANBIMA utiliza o fluxo OAuth2 <code>client_credentials</code> para autenticacao.
                O processo ocorre em 3 etapas, todas gerenciadas automaticamente pelo controller.
            </p>

            <div class="step-item">
                <h4><span class="step-number">1</span> Solicitar Access Token</h4>
                <p>POST para <code>/oauth/access-token</code> com header Authorization Basic (base64 de client_id:client_secret) e body com grant_type.</p>
            </div>

            <div class="step-item">
                <h4><span class="step-number">2</span> Receber Token</h4>
                <p>A API retorna um <code>access_token</code> valido por 3600 segundos (1 hora). O controller renova automaticamente 5 minutos antes da expiracao.</p>
            </div>

            <div class="step-item">
                <h4><span class="step-number">3</span> Usar nas Requisicoes</h4>
                <p>Cada chamada a API envia os headers <code>access_token</code> e <code>client_id</code> junto com Content-Type application/json.</p>
            </div>

            <h3>Codigo de Autenticacao</h3>
            <pre>
// Obter access token via OAuth2 (client_credentials)
async function getAccessToken() {
  // Retorna token em cache se ainda valido
  if (accessToken &amp;&amp; Date.now() &lt; tokenExpiresAt) {
    return accessToken;
  }

  // Codifica credenciais em Base64
  const credentials = Buffer.from(`${CLIENT_ID}:${CLIENT_SECRET}`).toString('base64');

  const res = await fetch(`${ANBIMA_URL}/oauth/access-token`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Basic ${credentials}`,
    },
    body: JSON.stringify({ grant_type: 'client_credentials' }),
  });

  if (!res.ok) {
    throw new Error(`ANBIMA OAuth error: ${res.status} ${res.statusText}`);
  }

  const data = await res.json();
  accessToken = data.access_token;
  // Renovar 5 minutos antes de expirar
  tokenExpiresAt = Date.now() + (data.expires_in - 300) * 1000;

  return accessToken;
}</pre>

            <h3>Requisicao Autenticada</h3>
            <pre>
// Requisicao autenticada a API ANBIMA
async function anbimaGet(endpoint) {
  const token = await getAccessToken();

  const res = await fetch(`${ANBIMA_URL}${endpoint}`, {
    headers: {
      'Content-Type': 'application/json',
      'access_token': token,
      'client_id': CLIENT_ID,
    },
  });

  if (!res.ok) {
    const text = await res.text();
    throw new Error(`ANBIMA API error: ${res.status} - ${text}`);
  }

  return res.json();
}</pre>
        </section>

        <!-- 4. ARQUITETURA -->
        <section id="arquitetura">
            <h2>Arquitetura</h2>
            <p>
                A integracao ANBIMA segue o padrao de arquitetura do projeto, com separacao em controller,
                routes e registro no server principal.
            </p>

            <div class="architecture-diagram">
                <h4>Fluxo de Dados - ANBIMA API</h4>
                <div class="arch-flow">
                    <div class="arch-box">
                        <strong>Frontend</strong><br>
                        <small>Next.js</small>
                    </div>
                    <span class="arch-arrow">&rarr;</span>
                    <div class="arch-box">
                        <strong>Backend API</strong><br>
                        <small>/api/anbima/*</small>
                    </div>
                    <span class="arch-arrow">&rarr;</span>
                    <div class="arch-box">
                        <strong>Cache</strong><br>
                        <small>In-Memory (5min)</small>
                    </div>
                    <span class="arch-arrow">&rarr;</span>
                    <div class="arch-box">
                        <strong>OAuth2 Token</strong><br>
                        <small>Auto-Refresh</small>
                    </div>
                    <span class="arch-arrow">&rarr;</span>
                    <div class="arch-box">
                        <strong>ANBIMA API</strong><br>
                        <small>api.anbima.com.br</small>
                    </div>
                </div>
            </div>

            <h3>Arquivos Criados</h3>
            <ul class="component-list">
                <li class="component-item">
                    <h4>backend/src/controllers/anbimaController.js <span class="new-badge">NOVO</span></h4>
                    <p>Controller principal com autenticacao OAuth2, 7 endpoints, cache em memoria (Map) com TTL de 5 minutos e formatacao de resposta padronizada.</p>
                </li>
                <li class="component-item">
                    <h4>backend/src/routes/anbima.js <span class="new-badge">NOVO</span></h4>
                    <p>Definicao de rotas Express com Router. Organizado em duas secoes: Titulos Publicos (Tesouro Direto) e Renda Fixa Privada (CRI/CRA, LF).</p>
                </li>
                <li class="component-item">
                    <h4>backend/src/server.js <span class="new-badge">Atualizado</span></h4>
                    <p>Registro das rotas ANBIMA no servidor Express: <code>app.use('/api/anbima', anbimaRoutes)</code>. Health check atualizado com status da ANBIMA.</p>
                </li>
            </ul>

            <h3>Estrutura de Arquivos</h3>
            <pre>
backend/src/
├── config/
│   └── index.js                 # Bloco anbima: baseUrl, clientId, clientSecret
├── controllers/
│   └── anbimaController.js      # OAuth2 + 7 endpoints + cache
├── routes/
│   └── anbima.js                # 7 rotas GET
└── server.js                    # Registro: app.use('/api/anbima', anbimaRoutes)</pre>

            <h3>Registro no Server</h3>
            <pre>
// backend/src/server.js
import anbimaRoutes from './routes/anbima.js';

// Routes - ANBIMA (Titulos Publicos, Renda Fixa, CRI/CRA)
app.use('/api/anbima', anbimaRoutes);

// Health check inclui status ANBIMA
app.get('/api/health', (req, res) =&gt; {
  res.json({
    status: 'ok',
    apis: {
      anbima: !!config.anbima.clientId,
      // ... outras APIs
    },
  });
});</pre>
        </section>

        <!-- 5. ENDPOINTS DISPONIVEIS -->
        <section id="endpoints">
            <h2>Endpoints Disponiveis</h2>
            <p>
                Todos os 7 endpoints aceitam o parametro opcional <code>?data=YYYY-MM-DD</code> para consultar
                dados de uma data especifica. Sem o parametro, retorna os dados mais recentes disponiveis.
            </p>

            <table class="api-table">
                <thead>
                    <tr>
                        <th>Metodo</th>
                        <th>Endpoint</th>
                        <th>Descricao</th>
                        <th>Atualizacao</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>GET</code></td>
                        <td><code>/api/anbima/titulos-publicos</code></td>
                        <td>Precos do mercado secundario de TPF</td>
                        <td>Diaria, apos 20h</td>
                    </tr>
                    <tr>
                        <td><code>GET</code></td>
                        <td><code>/api/anbima/vna</code></td>
                        <td>Valor Nominal Atualizado (LFT, NTN-B, NTN-C)</td>
                        <td>Diaria, 10h</td>
                    </tr>
                    <tr>
                        <td><code>GET</code></td>
                        <td><code>/api/anbima/curvas-juros</code></td>
                        <td>Curvas de juros</td>
                        <td>Diaria, apos 20h</td>
                    </tr>
                    <tr>
                        <td><code>GET</code></td>
                        <td><code>/api/anbima/estimativa-selic</code></td>
                        <td>Estimativa da taxa Selic</td>
                        <td>Diaria, 9:30</td>
                    </tr>
                    <tr>
                        <td><code>GET</code></td>
                        <td><code>/api/anbima/projecoes</code></td>
                        <td>Projecoes IPCA e IGP-M</td>
                        <td>Calendario oficial</td>
                    </tr>
                    <tr>
                        <td><code>GET</code></td>
                        <td><code>/api/anbima/cri-cra</code></td>
                        <td>Precos de CRI/CRA</td>
                        <td>Diaria, apos 20h</td>
                    </tr>
                    <tr>
                        <td><code>GET</code></td>
                        <td><code>/api/anbima/letras-financeiras</code></td>
                        <td>Letras Financeiras</td>
                        <td>Diaria, apos 20h</td>
                    </tr>
                </tbody>
            </table>

            <h3>Exemplos de Uso</h3>
            <pre>
# Titulos publicos (dados mais recentes)
GET http://localhost:3001/api/anbima/titulos-publicos

# Titulos publicos de uma data especifica
GET http://localhost:3001/api/anbima/titulos-publicos?data=2026-02-10

# Valor Nominal Atualizado
GET http://localhost:3001/api/anbima/vna

# Curvas de juros
GET http://localhost:3001/api/anbima/curvas-juros?data=2026-02-10

# Estimativa Selic
GET http://localhost:3001/api/anbima/estimativa-selic

# Projecoes (aceita mes e ano)
GET http://localhost:3001/api/anbima/projecoes?mes=02&amp;ano=2026

# CRI/CRA
GET http://localhost:3001/api/anbima/cri-cra

# Letras Financeiras
GET http://localhost:3001/api/anbima/letras-financeiras</pre>

            <h3>Endpoints ANBIMA Originais (Feed)</h3>
            <pre>
# Os endpoints internos mapeiam para a API oficial ANBIMA Feed:

/feed/precos-indices/v1/titulos-publicos/mercado-secundario-TPF
/feed/precos-indices/v1/titulos-publicos/vna
/feed/precos-indices/v1/titulos-publicos/curvas-juros
/feed/precos-indices/v1/titulos-publicos/estimativa-selic
/feed/precos-indices/v1/titulos-publicos/projecoes
/feed/precos-indices/v1/cri-cra/mercado-secundario
/feed/precos-indices/v1/letras-financeiras/matrizes-vertices-emissor</pre>
        </section>

        <!-- 6. STATUS DA INTEGRACAO -->
        <section id="status">
            <h2>Status da Integracao</h2>
            <p>
                Acompanhamento do progresso de implementacao da integracao com a API ANBIMA.
            </p>

            <table class="api-table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Status</th>
                        <th>Detalhes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Credenciais configuradas</strong></td>
                        <td class="status-ok">Concluido</td>
                        <td>client_id e client_secret no .env e config/index.js</td>
                    </tr>
                    <tr>
                        <td><strong>Controller com OAuth2</strong></td>
                        <td class="status-ok">Concluido</td>
                        <td>anbimaController.js com autenticacao, cache e 7 endpoints</td>
                    </tr>
                    <tr>
                        <td><strong>Rotas registradas</strong></td>
                        <td class="status-ok">Concluido</td>
                        <td>anbima.js com 7 rotas GET registradas no server.js</td>
                    </tr>
                    <tr>
                        <td><strong>Health check</strong></td>
                        <td class="status-ok">Concluido</td>
                        <td>/api/health retorna status da ANBIMA (anbima: true/false)</td>
                    </tr>
                    <tr>
                        <td><strong>Acesso a Producao</strong></td>
                        <td class="status-pending">Aguardando</td>
                        <td>Aguardando aprovacao via anbimafeed@anbima.com.br</td>
                    </tr>
                </tbody>
            </table>

            <div class="highlight-box" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <h4>Acesso a Producao</h4>
                <p>O acesso aos dados de producao da API ANBIMA requer aprovacao formal. O processo e feito via e-mail para anbimafeed@anbima.com.br com os dados da empresa/projeto. Enquanto aguarda aprovacao, o sistema esta preparado para funcionar assim que o acesso for liberado.</p>
            </div>
        </section>

        <!-- 7. CAMPOS DE RESPOSTA -->
        <section id="campos-resposta">
            <h2>Campos de Resposta</h2>
            <p>
                Principais campos retornados pelo endpoint de titulos publicos (<code>/api/anbima/titulos-publicos</code>).
                Os dados sao formatados pelo controller para um padrao consistente.
            </p>

            <table class="api-table">
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Tipo</th>
                        <th>Descricao</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>data_referencia</code></td>
                        <td>string</td>
                        <td>Data de referencia da precificacao (YYYY-MM-DD)</td>
                    </tr>
                    <tr>
                        <td><code>tipo_titulo</code></td>
                        <td>string</td>
                        <td>Tipo do titulo (LTN, LFT, NTN-B, NTN-C, NTN-F)</td>
                    </tr>
                    <tr>
                        <td><code>taxa_compra</code></td>
                        <td>number</td>
                        <td>Taxa de compra (% a.a.) no mercado secundario</td>
                    </tr>
                    <tr>
                        <td><code>taxa_venda</code></td>
                        <td>number</td>
                        <td>Taxa de venda (% a.a.) no mercado secundario</td>
                    </tr>
                    <tr>
                        <td><code>taxa_indicativa</code></td>
                        <td>number</td>
                        <td>Taxa indicativa ANBIMA (% a.a.) - referencia de mercado</td>
                    </tr>
                    <tr>
                        <td><code>pu</code></td>
                        <td>number</td>
                        <td>Preco Unitario do titulo (em R$)</td>
                    </tr>
                    <tr>
                        <td><code>codigo_selic</code></td>
                        <td>string</td>
                        <td>Codigo do titulo no sistema SELIC</td>
                    </tr>
                    <tr>
                        <td><code>data_vencimento</code></td>
                        <td>string</td>
                        <td>Data de vencimento do titulo (YYYY-MM-DD)</td>
                    </tr>
                </tbody>
            </table>

            <h3>Exemplo de Resposta Formatada</h3>
            <pre>
// GET /api/anbima/titulos-publicos
{
  "source": "ANBIMA",
  "type": "titulos_publicos",
  "data": [
    {
      "tipoTitulo": "LTN",
      "dataVencimento": "2027-01-01",
      "taxaCompra": 14.25,
      "taxaVenda": 14.30,
      "taxaIndicativa": 14.27,
      "pu": 785.432100,
      "codigoSelic": "100000",
      "dataReferencia": "2026-02-10"
    },
    {
      "tipoTitulo": "NTN-B",
      "dataVencimento": "2030-08-15",
      "taxaCompra": 6.85,
      "taxaVenda": 6.90,
      "taxaIndicativa": 6.87,
      "pu": 3245.678900,
      "codigoSelic": "760199",
      "dataReferencia": "2026-02-10"
    }
  ]
}

// Resposta com cache
{
  "source": "ANBIMA",
  "type": "titulos_publicos",
  "data": [...],
  "fromCache": true
}</pre>

            <h3>Cache em Memoria</h3>
            <pre>
// Sistema de cache simples com Map
const cache = new Map();
const CACHE_TTL = (config.cache.ttl || 300) * 1000; // 5 minutos padrao

function getCached(key) {
  const entry = cache.get(key);
  if (entry &amp;&amp; Date.now() - entry.timestamp &lt; CACHE_TTL) {
    return entry.data;
  }
  cache.delete(key);
  return null;
}

function setCache(key, data) {
  cache.set(key, { data, timestamp: Date.now() });
}

// Uso no controller:
const cacheKey = `tp_${data || 'latest'}`;
const cached = getCached(cacheKey);
if (cached) return res.json({ ...cached, fromCache: true });</pre>
        </section>
    </main>

    <footer>
        <p>Nuvary Invest - Documentacao Tecnica v3.1.0 - Fevereiro 2026</p>
        <p><a href="index.html">Voltar para o indice</a></p>
    </footer>
</body>
</html>
