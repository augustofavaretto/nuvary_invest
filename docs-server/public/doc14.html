<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doc 14 - Dashboard Principal | Nuvary Invest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00B8D9;
            --primary-dark: #007EA7;
            --secondary: #10b981;
            --dark: #0B1F33;
            --gray: #6B7280;
            --light: #F3F4F6;
            --white: #ffffff;
            --code-bg: #1e293b;
            --border: #E5E7EB;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #334155;
            background: var(--light);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, #0B1F33 0%, #00B8D9 100%);
            color: white;
            padding: 50px 0;
            text-align: center;
        }

        .version-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        nav {
            background: var(--white);
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        nav a {
            color: var(--gray);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--primary);
        }

        main {
            padding: 40px 0;
        }

        section {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        h2 {
            color: var(--dark);
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h3 {
            color: var(--dark);
            font-size: 1.2rem;
            margin: 25px 0 15px;
        }

        p {
            margin-bottom: 15px;
            color: #475569;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 25px;
            border-left: 4px solid var(--primary);
        }

        .feature-card h4 {
            color: var(--dark);
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-card p {
            color: var(--gray);
            font-size: 0.95rem;
            margin-bottom: 0;
        }

        .component-list {
            list-style: none;
            padding: 0;
        }

        .component-item {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--secondary);
        }

        .component-item h4 {
            color: var(--dark);
            font-size: 1rem;
            margin-bottom: 8px;
            font-family: 'Fira Code', monospace;
        }

        .component-item p {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 0;
        }

        pre {
            background: var(--code-bg);
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            margin: 15px 0;
        }

        code {
            font-family: 'Fira Code', 'Consolas', monospace;
            background: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9rem;
            color: var(--dark);
        }

        .api-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .api-table th,
        .api-table td {
            border: 1px solid var(--border);
            padding: 12px 15px;
            text-align: left;
        }

        .api-table th {
            background: var(--dark);
            color: white;
            font-weight: 600;
        }

        .api-table tr:nth-child(even) {
            background: #f8fafc;
        }

        .stock-badge {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .tech-badge {
            background: linear-gradient(135deg, var(--dark) 0%, #1e3a5f 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .architecture-diagram {
            background: linear-gradient(135deg, #0B1F33 0%, #1e3a5f 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .architecture-diagram h4 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .arch-flow {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .arch-box {
            background: rgba(255,255,255,0.1);
            padding: 15px 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .arch-arrow {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .highlight-box {
            background: linear-gradient(135deg, #00B8D9 0%, #007EA7 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .highlight-box h4 {
            margin-bottom: 10px;
        }

        footer {
            text-align: center;
            padding: 30px 0;
            color: var(--gray);
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <span class="version-badge">Versao 2.5.0</span>
            <h1>Dashboard Principal</h1>
            <p>Painel completo com dados de mercado, noticias e sugestoes de IA</p>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="index.html" style="color: #10b981; font-weight: 600;">Indice</a></li>
            <li><a href="#visao-geral">Visao Geral</a></li>
            <li><a href="#componentes">Componentes</a></li>
            <li><a href="#apis">APIs Integradas</a></li>
            <li><a href="#arquitetura">Arquitetura</a></li>
            <li><a href="#codigo">Codigo</a></li>
        </ul>
    </nav>

    <main class="container">
        <a href="index.html" class="back-link">Voltar para o indice</a>

        <section id="visao-geral">
            <h2>Visao Geral</h2>
            <p>
                O Dashboard Principal e a pagina central da aplicacao Nuvary Invest, exibida apos o login do usuario.
                Inspirado no portal do investidor da B3, foi desenvolvido com design original e integra todas as
                APIs financeiras do backend para fornecer uma experiencia completa de acompanhamento do mercado.
            </p>

            <div class="tech-stack">
                <span class="tech-badge">Next.js 16</span>
                <span class="tech-badge">React 19</span>
                <span class="tech-badge">TypeScript</span>
                <span class="tech-badge">Tailwind CSS v4</span>
                <span class="tech-badge">Framer Motion</span>
                <span class="tech-badge">shadcn/ui</span>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>ðŸ“Š Market Overview</h4>
                    <p>Cotacoes em tempo real das 5 principais acoes do mercado americano com variacao percentual e cores indicativas.</p>
                </div>
                <div class="feature-card">
                    <h4>ðŸ“ˆ Watchlist</h4>
                    <p>Lista de 6 acoes populares com precos atualizados, variacao do dia e link para mais detalhes.</p>
                </div>
                <div class="feature-card">
                    <h4>ðŸ“° Noticias</h4>
                    <p>Feed de noticias financeiras com headlines, fonte e tempo de publicacao.</p>
                </div>
                <div class="feature-card">
                    <h4>ðŸ¤– Sugestoes IA</h4>
                    <p>Dicas de investimento personalizadas geradas pela OpenAI baseadas no perfil do investidor.</p>
                </div>
                <div class="feature-card">
                    <h4>ðŸ‘¤ Perfil Investidor</h4>
                    <p>Card com o tipo de perfil (Conservador, Moderado, Arrojado, Agressivo) e alocacao recomendada.</p>
                </div>
                <div class="feature-card">
                    <h4>âš¡ Acoes Rapidas</h4>
                    <p>Botoes de acesso rapido para Chat IA, Perfil e Questionario.</p>
                </div>
            </div>

            <div class="highlight-box">
                <h4>Auto-Refresh</h4>
                <p>Os dados de mercado sao atualizados automaticamente a cada 60 segundos para manter as informacoes sempre atuais.</p>
            </div>
        </section>

        <section id="componentes">
            <h2>Componentes do Dashboard</h2>
            <p>O dashboard e composto por 8 componentes modulares, cada um com responsabilidade unica:</p>

            <ul class="component-list">
                <li class="component-item">
                    <h4>DashboardHeader.tsx</h4>
                    <p>Cabecalho com mensagem de boas-vindas personalizada e badge do perfil de investidor.</p>
                </li>
                <li class="component-item">
                    <h4>InvestorProfileCard.tsx</h4>
                    <p>Exibe o perfil de risco com barras de alocacao animadas (Renda Fixa, Acoes, FIIs, Internacional). Utiliza Framer Motion para animacoes suaves.</p>
                </li>
                <li class="component-item">
                    <h4>MarketOverview.tsx</h4>
                    <p>Grid com 5 cards de acoes principais: AAPL, MSFT, GOOGL, AMZN, TSLA. Mostra preco atual, variacao percentual e indicador de tendencia.</p>
                </li>
                <li class="component-item">
                    <h4>StockList.tsx</h4>
                    <p>Tabela com 6 acoes populares: META, NVDA, NFLX, JPM, V, DIS. Inclui nome da empresa, simbolo, preco e variacao.</p>
                </li>
                <li class="component-item">
                    <h4>NewsWidget.tsx</h4>
                    <p>Lista de noticias financeiras com headline, fonte e tempo relativo (ex: "2h atras"). Limite de 5 noticias para nao sobrecarregar.</p>
                </li>
                <li class="component-item">
                    <h4>AISuggestionsCard.tsx</h4>
                    <p>Sugestoes de investimento geradas pela OpenAI, contextualizadas com o perfil do usuario. Atualiza a cada carregamento.</p>
                </li>
                <li class="component-item">
                    <h4>QuickActionsPanel.tsx</h4>
                    <p>Tres botoes de acao rapida: Conversar com IA, Ver Perfil, Refazer Questionario.</p>
                </li>
                <li class="component-item">
                    <h4>DashboardErrorBoundary.tsx</h4>
                    <p>Error Boundary React para capturar erros nos componentes filhos e exibir fallback amigavel.</p>
                </li>
            </ul>
        </section>

        <section id="apis">
            <h2>APIs Integradas</h2>
            <p>O dashboard consome dados de multiplas APIs atraves do backend Node.js:</p>

            <table class="api-table">
                <thead>
                    <tr>
                        <th>API</th>
                        <th>Endpoint Backend</th>
                        <th>Dados Fornecidos</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Finnhub</strong></td>
                        <td><code>/api/finnhub/quote/:symbol</code></td>
                        <td>Cotacoes em tempo real, preco atual, variacao</td>
                    </tr>
                    <tr>
                        <td><strong>Finnhub</strong></td>
                        <td><code>/api/finnhub/candles/:symbol</code></td>
                        <td>Historico de precos (candlestick 30 dias)</td>
                    </tr>
                    <tr>
                        <td><strong>News API</strong></td>
                        <td><code>/api/news/business</code></td>
                        <td>Noticias de negocios e financas</td>
                    </tr>
                    <tr>
                        <td><strong>Finnhub</strong></td>
                        <td><code>/api/finnhub/news/market</code></td>
                        <td>Noticias de mercado (fallback)</td>
                    </tr>
                    <tr>
                        <td><strong>OpenAI</strong></td>
                        <td><code>/api/ai/suggestion</code></td>
                        <td>Sugestoes de investimento personalizadas</td>
                    </tr>
                    <tr>
                        <td><strong>Supabase</strong></td>
                        <td><code>perfil_investidor</code></td>
                        <td>Perfil de risco do usuario</td>
                    </tr>
                </tbody>
            </table>

            <h3>Simbolos Monitorados</h3>
            <p><strong>Market Overview:</strong></p>
            <div class="tech-stack">
                <span class="stock-badge">AAPL</span>
                <span class="stock-badge">MSFT</span>
                <span class="stock-badge">GOOGL</span>
                <span class="stock-badge">AMZN</span>
                <span class="stock-badge">TSLA</span>
            </div>

            <p><strong>Watchlist:</strong></p>
            <div class="tech-stack">
                <span class="stock-badge">META</span>
                <span class="stock-badge">NVDA</span>
                <span class="stock-badge">NFLX</span>
                <span class="stock-badge">JPM</span>
                <span class="stock-badge">V</span>
                <span class="stock-badge">DIS</span>
            </div>
        </section>

        <section id="arquitetura">
            <h2>Arquitetura</h2>

            <div class="architecture-diagram">
                <h4>Fluxo de Dados do Dashboard</h4>
                <div class="arch-flow">
                    <div class="arch-box">
                        <strong>Dashboard Page</strong><br>
                        <small>/app/dashboard</small>
                    </div>
                    <span class="arch-arrow">â†’</span>
                    <div class="arch-box">
                        <strong>useDashboardData</strong><br>
                        <small>Custom Hook</small>
                    </div>
                    <span class="arch-arrow">â†’</span>
                    <div class="arch-box">
                        <strong>dashboardService</strong><br>
                        <small>API Client</small>
                    </div>
                    <span class="arch-arrow">â†’</span>
                    <div class="arch-box">
                        <strong>Backend APIs</strong><br>
                        <small>Finnhub, News, AI</small>
                    </div>
                </div>
            </div>

            <h3>Estrutura de Arquivos</h3>
            <pre>
frontend/src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ dashboard/
â”‚       â””â”€â”€ page.tsx          # Pagina principal
â”œâ”€â”€ components/
â”‚   â””â”€â”€ dashboard/
â”‚       â”œâ”€â”€ index.ts          # Barrel exports
â”‚       â”œâ”€â”€ DashboardHeader.tsx
â”‚       â”œâ”€â”€ InvestorProfileCard.tsx
â”‚       â”œâ”€â”€ MarketOverview.tsx
â”‚       â”œâ”€â”€ StockList.tsx
â”‚       â”œâ”€â”€ NewsWidget.tsx
â”‚       â”œâ”€â”€ AISuggestionsCard.tsx
â”‚       â”œâ”€â”€ QuickActionsPanel.tsx
â”‚       â””â”€â”€ DashboardErrorBoundary.tsx
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useDashboardData.ts   # Hook de dados
â””â”€â”€ services/
    â””â”€â”€ dashboardService.ts   # Chamadas de API</pre>
        </section>

        <section id="codigo">
            <h2>Codigo Principal</h2>

            <h3>Custom Hook - useDashboardData.ts</h3>
            <pre>
import { useState, useEffect, useRef, useCallback } from 'react';
import {
  getMarketOverview,
  getWatchlist,
  getFinancialNews,
  getAISuggestions,
} from '@/services/dashboardService';
import { buscarPerfilInvestidor } from '@/services/perfilService';

export function useDashboardData() {
  const [marketData, setMarketData] = useState&lt;MarketStock[]&gt;([]);
  const [watchlist, setWatchlist] = useState&lt;WatchlistStock[]&gt;([]);
  const [news, setNews] = useState&lt;NewsItem[]&gt;([]);
  const [investorProfile, setInvestorProfile] = useState(null);
  const [aiSuggestions, setAiSuggestions] = useState&lt;string[]&gt;([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState&lt;string | null&gt;(null);

  const isMountedRef = useRef(true);

  const fetchAllData = useCallback(async () =&gt; {
    if (!isMountedRef.current) return;

    try {
      setLoading(true);

      // Fetch all data in parallel
      const [market, stocks, newsData, profile] = await Promise.all([
        getMarketOverview(),
        getWatchlist(),
        getFinancialNews(),
        buscarPerfilInvestidor(),
      ]);

      if (!isMountedRef.current) return;

      setMarketData(market);
      setWatchlist(stocks);
      setNews(newsData);
      setInvestorProfile(profile);

      // Fetch AI suggestions with profile context
      if (profile?.perfil_risco) {
        const suggestions = await getAISuggestions(profile.perfil_risco);
        if (isMountedRef.current) {
          setAiSuggestions(suggestions);
        }
      }
    } catch (err) {
      if (isMountedRef.current) {
        setError('Erro ao carregar dados');
      }
    } finally {
      if (isMountedRef.current) {
        setLoading(false);
      }
    }
  }, []);

  useEffect(() =&gt; {
    isMountedRef.current = true;
    fetchAllData();

    // Auto-refresh every 60 seconds
    const interval = setInterval(() =&gt; {
      fetchAllData();
    }, 60000);

    return () =&gt; {
      isMountedRef.current = false;
      clearInterval(interval);
    };
  }, [fetchAllData]);

  return {
    marketData,
    watchlist,
    news,
    investorProfile,
    aiSuggestions,
    loading,
    error,
    refetch: fetchAllData,
  };
}</pre>

            <h3>Service - dashboardService.ts</h3>
            <pre>
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001/api';

const MARKET_SYMBOLS = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA'];
const WATCHLIST_SYMBOLS = ['META', 'NVDA', 'NFLX', 'JPM', 'V', 'DIS'];

export async function getMarketOverview(): Promise&lt;MarketStock[]&gt; {
  const results: MarketStock[] = [];

  for (const symbol of MARKET_SYMBOLS) {
    try {
      const response = await fetch(`${API_URL}/finnhub/quote/${symbol}`);
      if (response.ok) {
        const data = await response.json();
        results.push({
          symbol,
          name: STOCK_NAMES[symbol],
          price: data.c || 0,
          change: data.dp || 0,
          changePercent: data.dp || 0,
        });
      }
      await delay(100); // Rate limiting
    } catch (error) {
      console.error(`Error fetching ${symbol}:`, error);
    }
  }

  return results;
}

export async function getAISuggestions(profileType: string): Promise&lt;string[]&gt; {
  try {
    const response = await fetch(`${API_URL}/ai/suggestion`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ profileType }),
    });

    if (response.ok) {
      const data = await response.json();
      return data.suggestions || [];
    }
  } catch (error) {
    console.error('Error fetching AI suggestions:', error);
  }
  return [];
}</pre>
        </section>

        <section>
            <h2>Tratamento de Erros</h2>
            <p>O dashboard implementa multiplas camadas de tratamento de erros:</p>

            <ul class="component-list">
                <li class="component-item">
                    <h4>isMountedRef</h4>
                    <p>Previne atualizacoes de estado apos o componente ser desmontado (React Strict Mode).</p>
                </li>
                <li class="component-item">
                    <h4>ErrorSuppressor</h4>
                    <p>Componente global que suprime AbortError causados pelo Next.js 16 em modo de desenvolvimento.</p>
                </li>
                <li class="component-item">
                    <h4>DashboardErrorBoundary</h4>
                    <p>Error Boundary que captura erros em componentes filhos e exibe UI de fallback.</p>
                </li>
                <li class="component-item">
                    <h4>Rate Limiting</h4>
                    <p>Delay de 100ms entre chamadas de API para evitar erro 429 (Too Many Requests).</p>
                </li>
            </ul>
        </section>

        <section>
            <h2>Proximos Passos</h2>
            <p>Melhorias planejadas para o dashboard:</p>
            <ul style="margin-left: 20px; color: var(--gray);">
                <li>Graficos de candlestick com Recharts</li>
                <li>Indicadores tecnicos visuais</li>
                <li>Estatisticas de uso do chat</li>
                <li>Portfolio de investimentos com tracking</li>
                <li>Alertas de preco em tempo real</li>
            </ul>
        </section>
    </main>

    <footer>
        <p>Nuvary Invest - Documentacao Tecnica | Fevereiro 2026</p>
        <p><a href="index.html">Voltar para o indice</a></p>
    </footer>
</body>
</html>
