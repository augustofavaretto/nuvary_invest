<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doc 10 - Chatbot Sidebar e Sistema de Conversas | Nuvary Invest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0066CC;
            --primary-dark: #0052A3;
            --secondary: #1C1C1C;
            --dark: #0B1F33;
            --gray: #6B7280;
            --light: #F3F4F6;
            --white: #ffffff;
            --code-bg: #1e293b;
            --border: #E5E7EB;
            --success: #10B981;
            --sidebar-bg: #171717;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #334155;
            background: var(--light);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, #171717 0%, #0066CC 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
        }

        .version-badge {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        nav {
            background: var(--white);
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        nav a {
            color: var(--gray);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--primary);
        }

        main {
            padding: 40px 0;
        }

        section {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        h2 {
            color: var(--dark);
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }

        h3 {
            color: var(--dark);
            font-size: 1.2rem;
            margin: 20px 0 15px;
        }

        p {
            margin-bottom: 15px;
            color: #475569;
        }

        ul, ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
            color: var(--primary-dark);
        }

        pre {
            background: var(--code-bg);
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }

        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .feature-card h4 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        .file-structure {
            background: var(--code-bg);
            color: #94a3b8;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
        }

        .file-structure .folder {
            color: #60a5fa;
        }

        .file-structure .file {
            color: #34d399;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .sidebar-preview {
            background: var(--sidebar-bg);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .sidebar-preview h4 {
            color: #9CA3AF;
            font-size: 0.8rem;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .sidebar-item {
            background: #262626;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .sidebar-item.active {
            background: #374151;
        }

        .info-box {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            border-left: 4px solid var(--primary);
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }

        .success-box {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-left: 4px solid var(--success);
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }

        footer {
            text-align: center;
            padding: 30px 0;
            color: var(--gray);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--light);
            color: var(--dark);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <span class="version-badge">Versao 2.1.0</span>
            <h1>Chatbot Sidebar e Sistema de Conversas</h1>
            <p>Interface redesenhada com sidebar lateral, multiplas conversas e historico organizado</p>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="#visao-geral">Visao Geral</a></li>
            <li><a href="#componentes">Componentes</a></li>
            <li><a href="#funcionalidades">Funcionalidades</a></li>
            <li><a href="#banco-dados">Banco de Dados</a></li>
            <li><a href="#services">Services</a></li>
        </ul>
    </nav>

    <main class="container">
        <a href="index.html" class="back-link">← Voltar para o indice</a>

        <section id="visao-geral">
            <h2>Visao Geral</h2>
            <p>Redesign completo da interface do chatbot seguindo o padrao de interfaces modernas como ChatGPT e Claude. A nova interface inclui uma sidebar lateral com historico de conversas, busca, e gerenciamento de multiplas conversas.</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Sidebar Lateral</h4>
                    <p>Menu lateral escuro com lista de conversas, botao nova conversa e busca integrada</p>
                </div>
                <div class="feature-card">
                    <h4>Multiplas Conversas</h4>
                    <p>Sistema de UUID para identificar e gerenciar diferentes conversas do usuario</p>
                </div>
                <div class="feature-card">
                    <h4>Historico Organizado</h4>
                    <p>Conversas agrupadas por data: Hoje, Ontem, Ultimos 7 dias, Ultimos 30 dias</p>
                </div>
                <div class="feature-card">
                    <h4>Acoes Rapidas</h4>
                    <p>Deletar conversas individuais ou limpar todo o historico</p>
                </div>
            </div>

            <h3>Preview da Sidebar</h3>
            <div class="sidebar-preview">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <span style="font-weight: 600;">Nova conversa</span>
                    <span style="background: #374151; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem;">+</span>
                </div>
                <input type="text" placeholder="Buscar conversas..." style="width: 100%; padding: 10px; border-radius: 8px; border: none; background: #262626; color: white; margin-bottom: 20px;">
                <h4>Hoje</h4>
                <div class="sidebar-item active">Como investir em acoes?</div>
                <div class="sidebar-item">Analise de FIIs</div>
                <h4 style="margin-top: 15px;">Ontem</h4>
                <div class="sidebar-item">Diversificacao de carteira</div>
            </div>
        </section>

        <section id="componentes">
            <h2>Componentes Criados</h2>

            <h3>Estrutura de Arquivos</h3>
            <div class="file-structure">
                <span class="folder">frontend/src/</span><br>
                ├── <span class="folder">components/chat/</span><br>
                │   ├── <span class="file">Chatbot.tsx</span> (redesenhado)<br>
                │   └── <span class="file">ChatSidebar.tsx</span> (novo)<br>
                └── <span class="folder">services/</span><br>
                    └── <span class="file">chatService.ts</span> (atualizado)
            </div>

            <h3>ChatSidebar.tsx</h3>
            <p>Componente responsavel pela sidebar lateral com as seguintes funcionalidades:</p>
            <ul>
                <li>Botao "Nova conversa" para iniciar novo chat</li>
                <li>Campo de busca para filtrar conversas</li>
                <li>Lista de conversas agrupadas por data</li>
                <li>Botao de deletar conversa individual (hover)</li>
                <li>Botao "Limpar historico" para apagar tudo</li>
                <li>Sidebar colapsavel em telas menores</li>
            </ul>

            <pre><code>interface ChatSidebarProps {
  conversas: Conversa[];
  conversaAtual: string | null;
  onNovaConversa: () => void;
  onSelecionarConversa: (id: string) => void;
  onDeletarConversa: (id: string) => void;
  onLimparHistorico: () => void;
  collapsed: boolean;
  onToggleCollapse: () => void;
}</code></pre>

            <h3>Chatbot.tsx (Redesenhado)</h3>
            <p>O componente principal foi reestruturado para integrar a sidebar:</p>
            <ul>
                <li>Layout flex com sidebar + area de chat</li>
                <li>Gerenciamento de estado da conversa atual</li>
                <li>UUID para identificar cada conversa</li>
                <li>Carregamento de mensagens por conversa</li>
            </ul>
        </section>

        <section id="funcionalidades">
            <h2>Funcionalidades Detalhadas</h2>

            <h3>1. Nova Conversa</h3>
            <p>Ao clicar em "Nova conversa", um novo UUID e gerado e a area de chat e limpa para iniciar uma nova interacao.</p>
            <pre><code>const novaConversa = () => {
  const novoId = gerarConversaId();
  setConversaAtual(novoId);
  setMensagens([]);
};</code></pre>

            <h3>2. Busca de Conversas</h3>
            <p>O campo de busca filtra as conversas em tempo real pelo titulo (primeira mensagem do usuario).</p>
            <pre><code>const conversasFiltradas = conversas.filter(c =>
  c.titulo.toLowerCase().includes(busca.toLowerCase())
);</code></pre>

            <h3>3. Agrupamento por Data</h3>
            <p>As conversas sao organizadas em grupos temporais para facilitar a navegacao:</p>
            <table>
                <tr>
                    <th>Grupo</th>
                    <th>Criterio</th>
                </tr>
                <tr>
                    <td>Hoje</td>
                    <td>Conversas do dia atual</td>
                </tr>
                <tr>
                    <td>Ontem</td>
                    <td>Conversas do dia anterior</td>
                </tr>
                <tr>
                    <td>Ultimos 7 dias</td>
                    <td>Conversas da ultima semana</td>
                </tr>
                <tr>
                    <td>Ultimos 30 dias</td>
                    <td>Conversas do ultimo mes</td>
                </tr>
                <tr>
                    <td>Mais antigas</td>
                    <td>Conversas anteriores</td>
                </tr>
            </table>

            <h3>4. Deletar Conversa</h3>
            <p>Cada conversa pode ser deletada individualmente. O botao aparece ao passar o mouse sobre o item.</p>

            <h3>5. Limpar Historico</h3>
            <p>Apaga todas as conversas do usuario apos confirmacao.</p>
        </section>

        <section id="banco-dados">
            <h2>Banco de Dados - Supabase</h2>

            <h3>Alteracao na Tabela chat_historico</h3>
            <p>Foi adicionada uma coluna para identificar a conversa:</p>

            <pre><code>-- Adicionar coluna conversa_id
ALTER TABLE chat_historico
ADD COLUMN conversa_id UUID DEFAULT gen_random_uuid();

-- Criar indice para performance
CREATE INDEX idx_chat_historico_conversa
ON chat_historico(user_id, conversa_id);

-- Atualizar conversas existentes (opcional)
UPDATE chat_historico
SET conversa_id = gen_random_uuid()
WHERE conversa_id IS NULL;</code></pre>

            <h3>Estrutura Atualizada</h3>
            <table>
                <tr>
                    <th>Coluna</th>
                    <th>Tipo</th>
                    <th>Descricao</th>
                </tr>
                <tr>
                    <td>id</td>
                    <td>UUID</td>
                    <td>ID unico da mensagem</td>
                </tr>
                <tr>
                    <td>user_id</td>
                    <td>UUID</td>
                    <td>ID do usuario (FK auth.users)</td>
                </tr>
                <tr>
                    <td>conversa_id</td>
                    <td>UUID</td>
                    <td>ID da conversa (novo)</td>
                </tr>
                <tr>
                    <td>role</td>
                    <td>VARCHAR</td>
                    <td>'user' ou 'assistant'</td>
                </tr>
                <tr>
                    <td>content</td>
                    <td>TEXT</td>
                    <td>Conteudo da mensagem</td>
                </tr>
                <tr>
                    <td>created_at</td>
                    <td>TIMESTAMP</td>
                    <td>Data/hora da mensagem</td>
                </tr>
            </table>
        </section>

        <section id="services">
            <h2>Services Atualizados</h2>

            <h3>chatService.ts</h3>
            <p>Novas funcoes adicionadas ao servico de chat:</p>

            <pre><code>// Gerar ID unico para conversa
export function gerarConversaId(): string {
  return crypto.randomUUID();
}

// Listar todas as conversas do usuario
export async function listarConversas(): Promise&lt;Conversa[]&gt; {
  // Agrupa mensagens por conversa_id e retorna titulo + data
}

// Buscar conversas por termo
export async function buscarConversas(termo: string): Promise&lt;Conversa[]&gt; {
  // Filtra conversas que contem o termo
}

// Buscar mensagens de uma conversa especifica
export async function buscarMensagensPorConversa(
  conversaId: string
): Promise&lt;Mensagem[]&gt; {
  // Retorna mensagens ordenadas por data
}

// Deletar uma conversa
export async function deletarConversa(conversaId: string): Promise&lt;void&gt; {
  // Remove todas as mensagens da conversa
}

// Salvar mensagem com conversa_id
export async function salvarMensagem(
  mensagem: string,
  role: 'user' | 'assistant',
  conversaId: string
): Promise&lt;void&gt; {
  // Salva mensagem associada a conversa
}</code></pre>

            <div class="success-box">
                <strong>Resultado:</strong> Interface do chatbot completamente redesenhada, oferecendo uma experiencia similar ao ChatGPT e Claude, com gerenciamento eficiente de multiplas conversas e historico organizado.
            </div>
        </section>
    </main>

    <footer>
        <p>Nuvary Invest - Documentacao Tecnica | Janeiro 2024</p>
        <p><a href="index.html">← Voltar para o indice</a></p>
    </footer>
</body>
</html>
